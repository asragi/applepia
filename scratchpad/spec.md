# Ringoゲーム仕様書作成プラン

## 目的

backend以外の実装者（フロントエンド、他サービス等）がbackendに対して処理を書く際に参照する仕様書を作成する。
dev/frontendは読む必要ありません．

## ユーザー要件

- **主要読者**: backend以外の実装者
- **主目的**: backendのAPI仕様を理解し、利用する
- **詳細度**: API仕様を重点的に。実装詳細は最低限。
- **ディレクトリ**: `spec/`
- **構成**: 分割ファイル、番号付け不要（検索性優先）
- **形式**: Markdown、日本語

## 除外事項

- ファイル番号付け（検索で取り出せることを優先）
- 索引（不要）
- マスターデータ仕様（一時的なため）
- フロントエンド実装の記述（全て不要）
- テスト戦略・実装例（不要）
- backend内部の実装詳細（最低限のみ）
- 技術スタック
- システム構成図

## 必須事項

- **API仕様を重点的に記述**
- **ゲームデザインの計算式を簡潔かつ網羅的に**
- **利用側として最低限必要な内容**

## ディレクトリ構造

spec/
├── overview.md # プロジェクト概要
├── game_design.md # ゲームデザイン（ルール、計算式）
├── database.md # データベーススキーマ（API利用者が知るべき構造）
└── api.md # API仕様（最重要、詳細に記述）


**総ファイル数**: 4ファイル（シンプル化）

## ファイル分割方針

1. **API仕様を最重点**: `api.md`が最も詳細
2. **ゲームルールを明確に**: `game_design.md`で計算式を網羅
3. **DB構造は参照程度**: API利用に必要な範囲のみ
4. **実装詳細は最低限**: backend内部の詳細は省略

## 各ファイルの概要

### overview.md（プロジェクト概要）

**目的**: プロジェクト全体像の把握

**内容**:
- プロジェクト概要（1-2段落）
- ゲーム概要（コアループ、目的）
- 認証方式（トークンベース）

**ページ数**: 1ページ

### game_design.md（ゲームデザイン）

**目的**: ゲームルールと計算式の理解

**内容**:
- **ゲームループ**: 探索→陳列→販売→ランキング
- **リソース**:
  - スタミナ（回復式、消費式、軽減式）
  - 資金（獲得、消費）
  - 人気度（変動式）
- **スキルシステム**:
  - レベル計算式
  - 経験値計算式
  - 軽減率適用式
- **探索システム**:
  - スタミナ消費計算
  - アイテム獲得判定
  - スキル成長計算
- **棚システム**:
  - 価格設定範囲
  - 在庫管理
- **予約システム**:
  - 価格ペナルティ計算
  - 棚魅力度計算
  - 購入確率計算
  - 来店客数計算
  - 予約生成ロジック
- **ランキングシステム**:
  - スコア計算式

**記述方針**:
- 全計算式を数式で明示
- 簡潔に、網羅的に
- 実装例は不要、式のみ

**ページ数**: 4-6ページ

### database.md（データベーススキーマ）

**目的**: API利用者が知るべきデータ構造の理解

**内容**:
- **ER図**（簡易版）
- **主要テーブル**（11テーブル）:
  - users（ユーザー情報）
  - item_storages（アイテム所持）
  - user_skills（スキル経験値）
  - shelves（棚）
  - reservations（予約）
  - scores（スコア）
  - rank_period_table（ランキング期間）
  - winners（優勝者）
  - item_masters（アイテムマスター）
  - skill_masters（スキルマスター）
  - explore_masters（探索マスター）
  - stage_masters（ステージマスター）

**各テーブル記述内容**:
- カラム名、型、説明（簡潔に）
- 主キー、外部キー
- インデックス（主要なもののみ）

**記述方針**:
- API利用者が理解すべき範囲に限定
- 内部実装の詳細は省略

**ページ数**: 3-5ページ

### api.md（API仕様）

**目的**: backend APIの完全な仕様（最重要）

**内容**:
- **概要**:
  - 通信プロトコル（gRPC）
  - 認証方式（トークン）
  - エラーハンドリング（gRPCステータスコード）

- **エンドポイント一覧**（19個）:

  **認証API**:
  1. SignUp（ユーザー登録）
  2. Login（ログイン）

  **リソースAPI**:
  3. GetResource（リソース取得）
  4. UpdateUserName（ユーザー名更新）
  5. UpdateShopName（店舗名更新）

  **探索API**:
  6. GetStageList（ステージ一覧取得）
  7. GetStageActionDetail（アクション詳細取得）
  8. PostAction（アクション実行）
  9. GetItemList（アイテム一覧取得）
  10. GetItemDetail（アイテム詳細取得）
  11. GetItemActionDetail（アイテムアクション詳細取得）

  **棚API**:
  12. GetMyShelves（自分の棚一覧取得）
  13. UpdateShelfContent（棚内容更新）
  14. UpdateShelfSize（棚サイズ更新）

  **ランキングAPI**:
  15. GetRankingUserList（ランキング取得）

  **管理者API**:
  16. AdminLogin（管理者ログイン）
  17. ChangePeriod（期間変更）
  18. ChangeTime（時刻変更）
  19. AutoInsertReservation（予約自動生成）

**各エンドポイント記述内容**:
- **エンドポイント名**
- **Request**:
  - Protocol Buffers定義
  - 各フィールドの説明
  - バリデーションルール
- **Response**:
  - Protocol Buffers定義
  - 各フィールドの説明
- **処理概要**（1-3行）
- **エラーケース**:
  - gRPCステータスコード
  - エラー条件
  - エラーメッセージ例
- **備考**（必要に応じて）

**共通仕様**:
- 認証ヘッダー形式
- gRPCエラーコードマッピング
- リトライポリシー（推奨）

**記述方針**:
- API利用者が実装できるレベルの詳細度
- Request/Responseを完全に記述
- エラーケースを網羅
- 内部実装は言及しない

**ページ数**: 10-15ページ（最も詳細）

## 重要な参照ファイル

実装時に参照すべき既存ファイル：

1. `/Users/ragi/work/ringo/ringo/dev/protocol-buffer/gateway/schema.proto` - 全APIエンドポイント定義（最重要）
2. `/Users/ragi/work/ringo/ringo/dev/backend/core/game/shelf/reservation/models.go` - 予約システム計算ロジック
3. `/Users/ragi/work/ringo/ringo/dev/backend/docker/mysql/init/00_init.sql` - 完全なDBスキーマ定義
4. `/Users/ragi/work/ringo/ringo/dev/backend/CLAUDE.md` - バックエンド設計原則（参考程度）

## 実装手順

1. **ディレクトリ作成**: プロジェクト直下に`spec/`を作成
2. **overview.md作成**: プロジェクト概要
3. **game_design.md作成**: ゲームルール、全計算式
4. **database.md作成**: DB構造（API利用者向け）
5. **api.md作成**: 19エンドポイントの詳細仕様（最重点）

## 期待される成果

- **API中心**: backend利用者が必要な情報に集中
- **検索性**: 番号なし、適切な見出しで検索しやすく
- **簡潔性**: 不要な情報を削減、必要な情報を網羅
- **実用性**: API実装時に直接参照可能
- **保守性**: Markdown形式でバージョン管理可能

## 見積もり

- **総ファイル数**: 4ファイル
- **総ページ数**: 16-26ページ
- **作成時間**: 8-12時間（見積もり）
